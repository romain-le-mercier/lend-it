{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports.buildQueryDescription = buildQueryDescription;\nexports.queryWithoutDeleted = queryWithoutDeleted;\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\nvar _fp = require(\"../utils/fp\");\nvar _invariant = _interopRequireDefault(require(\"../utils/common/invariant\"));\nvar _deepFreeze = _interopRequireDefault(require(\"../utils/common/deepFreeze\"));\nvar _Schema = require(\"../Schema\");\nvar _operators = require(\"./operators\");\nvar syncStatusColumn = (0, _Schema.columnName)('_status');\nvar extractClauses = function extractClauses(clauses) {\n  var query = {\n    where: [],\n    joinTables: [],\n    nestedJoinTables: [],\n    sortBy: []\n  };\n  clauses.forEach(function (clause) {\n    switch (clause.type) {\n      case 'where':\n      case 'and':\n      case 'or':\n      case 'sql':\n      case 'loki':\n        query.where.push(clause);\n        break;\n      case 'on':\n        {\n          var table = clause.table;\n          query.joinTables.push(table);\n          query.where.push(clause);\n          break;\n        }\n      case 'sortBy':\n        query.sortBy.push(clause);\n        break;\n      case 'take':\n        query.take = clause.count;\n        break;\n      case 'skip':\n        query.skip = clause.count;\n        break;\n      case 'joinTables':\n        {\n          var _query$joinTables;\n          var tables = clause.tables;\n          (_query$joinTables = query.joinTables).push.apply(_query$joinTables, (0, _toConsumableArray2.default)(tables));\n          break;\n        }\n      case 'nestedJoinTable':\n        query.nestedJoinTables.push({\n          from: clause.from,\n          to: clause.to\n        });\n        break;\n      case 'lokiTransform':\n        query.lokiTransform = clause.function;\n        break;\n      case 'sqlQuery':\n        query.sql = clause;\n        if ('production' !== process.env.NODE_ENV) {\n          (0, _invariant.default)(clauses.every(function (_clause) {\n            return ['sqlQuery', 'joinTables', 'nestedJoinTable'].includes(_clause.type);\n          }), 'Cannot use Q.unsafeSqlQuery with other clauses, except for Q.experimentalJoinTables and Q.experimentalNestedJoin (Did you mean Q.unsafeSqlExpr?)');\n        }\n        break;\n      default:\n        throw new Error('Invalid Query clause passed');\n    }\n  });\n  query.joinTables = (0, _fp.unique)(query.joinTables);\n  return query;\n};\nfunction buildQueryDescription(clauses) {\n  var query = extractClauses(clauses);\n  if ('production' !== process.env.NODE_ENV) {\n    (0, _invariant.default)(!(query.skip && !query.take), 'cannot skip without take');\n    (0, _deepFreeze.default)(query);\n  }\n  return query;\n}\nvar whereNotDeleted = (0, _operators.where)(syncStatusColumn, (0, _operators.notEq)('deleted'));\nfunction conditionsWithoutDeleted(conditions) {\n  return conditions.map(queryWithoutDeletedImpl);\n}\nfunction queryWithoutDeletedImpl(clause) {\n  if ('and' === clause.type) {\n    return {\n      type: 'and',\n      conditions: conditionsWithoutDeleted(clause.conditions)\n    };\n  } else if ('or' === clause.type) {\n    return {\n      type: 'or',\n      conditions: conditionsWithoutDeleted(clause.conditions)\n    };\n  } else if ('on' === clause.type) {\n    var onClause = clause;\n    return {\n      type: 'on',\n      table: onClause.table,\n      conditions: conditionsWithoutDeleted(onClause.conditions).concat(whereNotDeleted)\n    };\n  }\n  return clause;\n}\nfunction queryWithoutDeleted(query) {\n  var whereConditions = query.where;\n  var newQuery = (0, _extends2.default)({}, query, {\n    where: conditionsWithoutDeleted(whereConditions).concat(whereNotDeleted)\n  });\n  if ('production' !== process.env.NODE_ENV) {\n    (0, _deepFreeze.default)(newQuery);\n  }\n  return newQuery;\n}","map":{"version":3,"names":["_interopRequireDefault","require","exports","__esModule","buildQueryDescription","queryWithoutDeleted","_extends2","_toConsumableArray2","_fp","_invariant","_deepFreeze","_Schema","_operators","syncStatusColumn","columnName","extractClauses","clauses","query","where","joinTables","nestedJoinTables","sortBy","forEach","clause","type","push","table","take","count","skip","_query$joinTables","tables","apply","default","from","to","lokiTransform","function","sql","process","env","NODE_ENV","every","_clause","includes","Error","unique","whereNotDeleted","notEq","conditionsWithoutDeleted","conditions","map","queryWithoutDeletedImpl","onClause","concat","whereConditions","newQuery"],"sources":["/app/node_modules/@nozbe/watermelondb/QueryDescription/helpers.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports.buildQueryDescription = buildQueryDescription;\nexports.queryWithoutDeleted = queryWithoutDeleted;\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\nvar _fp = require(\"../utils/fp\");\nvar _invariant = _interopRequireDefault(require(\"../utils/common/invariant\"));\nvar _deepFreeze = _interopRequireDefault(require(\"../utils/common/deepFreeze\"));\nvar _Schema = require(\"../Schema\");\nvar _operators = require(\"./operators\");\n/* eslint-disable no-use-before-define */\n// don't import whole `utils` to keep worker size small\nvar syncStatusColumn = (0, _Schema.columnName)('_status');\nvar extractClauses = function (clauses) {\n  var query = {\n    where: [],\n    joinTables: [],\n    nestedJoinTables: [],\n    sortBy: []\n  };\n  clauses.forEach(function (clause) {\n    switch (clause.type) {\n      case 'where':\n      case 'and':\n      case 'or':\n      case 'sql':\n      case 'loki':\n        query.where.push(clause);\n        break;\n      case 'on':\n        {\n          var {\n            table: table\n          } = clause;\n          query.joinTables.push(table);\n          query.where.push(clause);\n          break;\n        }\n      case 'sortBy':\n        query.sortBy.push(clause);\n        break;\n      case 'take':\n        query.take = clause.count;\n        break;\n      case 'skip':\n        query.skip = clause.count;\n        break;\n      case 'joinTables':\n        {\n          var _query$joinTables;\n          var {\n            tables: tables\n          } = clause;\n          (_query$joinTables = query.joinTables).push.apply(_query$joinTables, (0, _toConsumableArray2.default)(tables));\n          break;\n        }\n      case 'nestedJoinTable':\n        query.nestedJoinTables.push({\n          from: clause.from,\n          to: clause.to\n        });\n        break;\n      case 'lokiTransform':\n        // TODO: Check for duplicates\n        query.lokiTransform = clause.function;\n        break;\n      case 'sqlQuery':\n        query.sql = clause;\n        if ('production' !== process.env.NODE_ENV) {\n          (0, _invariant.default)(clauses.every(function (_clause) {\n            return ['sqlQuery', 'joinTables', 'nestedJoinTable'].includes(_clause.type);\n          }), 'Cannot use Q.unsafeSqlQuery with other clauses, except for Q.experimentalJoinTables and Q.experimentalNestedJoin (Did you mean Q.unsafeSqlExpr?)');\n        }\n        break;\n      default:\n        throw new Error('Invalid Query clause passed');\n    }\n  });\n  query.joinTables = (0, _fp.unique)(query.joinTables);\n\n  // $FlowFixMe: Flow is too dumb to realize that it is valid\n  return query;\n};\nfunction buildQueryDescription(clauses) {\n  var query = extractClauses(clauses);\n  if ('production' !== process.env.NODE_ENV) {\n    (0, _invariant.default)(!(query.skip && !query.take), 'cannot skip without take');\n    (0, _deepFreeze.default)(query);\n  }\n  return query;\n}\nvar whereNotDeleted = (0, _operators.where)(syncStatusColumn, (0, _operators.notEq)('deleted'));\nfunction conditionsWithoutDeleted(conditions) {\n  return conditions.map(queryWithoutDeletedImpl);\n}\nfunction queryWithoutDeletedImpl(clause) {\n  if ('and' === clause.type) {\n    return {\n      type: 'and',\n      conditions: conditionsWithoutDeleted(clause.conditions)\n    };\n  } else if ('or' === clause.type) {\n    return {\n      type: 'or',\n      conditions: conditionsWithoutDeleted(clause.conditions)\n    };\n  } else if ('on' === clause.type) {\n    var onClause = clause;\n    return {\n      type: 'on',\n      table: onClause.table,\n      conditions: conditionsWithoutDeleted(onClause.conditions).concat(whereNotDeleted)\n    };\n  }\n  return clause;\n}\nfunction queryWithoutDeleted(query) {\n  var {\n    where: whereConditions\n  } = query;\n  var newQuery = (0, _extends2.default)({}, query, {\n    where: conditionsWithoutDeleted(whereConditions).concat(whereNotDeleted)\n  });\n  if ('production' !== process.env.NODE_ENV) {\n    (0, _deepFreeze.default)(newQuery);\n  }\n  return newQuery;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}