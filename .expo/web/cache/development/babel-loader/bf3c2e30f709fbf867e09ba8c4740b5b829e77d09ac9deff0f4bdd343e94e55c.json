{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.default = performJoins;\nfunction performJoinsImpl(query, performer) {\n  if (!query) {\n    return query;\n  } else if (query.$join) {\n    var _ref;\n    var _join = query.$join;\n    var joinQuery = performJoinsImpl(_join.query, performer);\n    _join.query = joinQuery;\n    var records = performer(_join);\n    var matchingIds = records.map(function (record) {\n      return record[_join.mapKey];\n    });\n    return _ref = {}, _ref[_join.joinKey] = {\n      $in: matchingIds\n    }, _ref;\n  } else if (query.$and) {\n    return {\n      $and: query.$and.map(function (clause) {\n        return performJoinsImpl(clause, performer);\n      })\n    };\n  } else if (query.$or) {\n    return {\n      $or: query.$or.map(function (clause) {\n        return performJoinsImpl(clause, performer);\n      })\n    };\n  }\n  return query;\n}\nfunction performJoins(lokiQuery, performer) {\n  var query = lokiQuery.query,\n    hasJoins = lokiQuery.hasJoins;\n  if (!hasJoins) {\n    return query;\n  }\n  return performJoinsImpl(query, performer);\n}","map":{"version":3,"names":["exports","__esModule","default","performJoins","performJoinsImpl","query","performer","$join","_ref","_join","joinQuery","records","matchingIds","map","record","mapKey","joinKey","$in","$and","clause","$or","lokiQuery","hasJoins"],"sources":["/app/node_modules/@nozbe/watermelondb/adapters/lokijs/worker/performJoins/index.js"],"sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.default = performJoins;\nfunction performJoinsImpl(query, performer) {\n  if (!query) {\n    return query;\n  } else if (query.$join) {\n    var _ref;\n    var _join = query.$join;\n    var joinQuery = performJoinsImpl(_join.query, performer);\n    _join.query = joinQuery;\n    var records = performer(_join);\n\n    // for queries on `belongs_to` tables, matchingIds will be IDs of the parent table records\n    //   (e.g. task: { project_id in ids })\n    // and for `has_many` tables, it will be IDs of the main table records\n    //   (e.g. task: { id in (ids from tag_assignment.task_id) })\n    var matchingIds = records.map(function (record) {\n      return record[_join.mapKey];\n    });\n    return _ref = {}, _ref[_join.joinKey] = {\n      $in: matchingIds\n    }, _ref;\n  } else if (query.$and) {\n    return {\n      $and: query.$and.map(function (clause) {\n        return performJoinsImpl(clause, performer);\n      })\n    };\n  } else if (query.$or) {\n    return {\n      $or: query.$or.map(function (clause) {\n        return performJoinsImpl(clause, performer);\n      })\n    };\n  }\n  return query;\n}\nfunction performJoins(lokiQuery, performer) {\n  var {\n    query: query,\n    hasJoins: hasJoins\n  } = lokiQuery;\n  if (!hasJoins) {\n    return query;\n  }\n  return performJoinsImpl(query, performer);\n}"],"mappings":"AAAA,YAAY;;AAEZA,OAAO,CAACC,UAAU,GAAG,IAAI;AACzBD,OAAO,CAACE,OAAO,GAAGC,YAAY;AAC9B,SAASC,gBAAgBA,CAACC,KAAK,EAAEC,SAAS,EAAE;EAC1C,IAAI,CAACD,KAAK,EAAE;IACV,OAAOA,KAAK;EACd,CAAC,MAAM,IAAIA,KAAK,CAACE,KAAK,EAAE;IACtB,IAAIC,IAAI;IACR,IAAIC,KAAK,GAAGJ,KAAK,CAACE,KAAK;IACvB,IAAIG,SAAS,GAAGN,gBAAgB,CAACK,KAAK,CAACJ,KAAK,EAAEC,SAAS,CAAC;IACxDG,KAAK,CAACJ,KAAK,GAAGK,SAAS;IACvB,IAAIC,OAAO,GAAGL,SAAS,CAACG,KAAK,CAAC;IAM9B,IAAIG,WAAW,GAAGD,OAAO,CAACE,GAAG,CAAC,UAAUC,MAAM,EAAE;MAC9C,OAAOA,MAAM,CAACL,KAAK,CAACM,MAAM,CAAC;IAC7B,CAAC,CAAC;IACF,OAAOP,IAAI,GAAG,CAAC,CAAC,EAAEA,IAAI,CAACC,KAAK,CAACO,OAAO,CAAC,GAAG;MACtCC,GAAG,EAAEL;IACP,CAAC,EAAEJ,IAAI;EACT,CAAC,MAAM,IAAIH,KAAK,CAACa,IAAI,EAAE;IACrB,OAAO;MACLA,IAAI,EAAEb,KAAK,CAACa,IAAI,CAACL,GAAG,CAAC,UAAUM,MAAM,EAAE;QACrC,OAAOf,gBAAgB,CAACe,MAAM,EAAEb,SAAS,CAAC;MAC5C,CAAC;IACH,CAAC;EACH,CAAC,MAAM,IAAID,KAAK,CAACe,GAAG,EAAE;IACpB,OAAO;MACLA,GAAG,EAAEf,KAAK,CAACe,GAAG,CAACP,GAAG,CAAC,UAAUM,MAAM,EAAE;QACnC,OAAOf,gBAAgB,CAACe,MAAM,EAAEb,SAAS,CAAC;MAC5C,CAAC;IACH,CAAC;EACH;EACA,OAAOD,KAAK;AACd;AACA,SAASF,YAAYA,CAACkB,SAAS,EAAEf,SAAS,EAAE;EAC1C,IACSD,KAAK,GAEVgB,SAAS,CAFXhB,KAAK;IACKiB,QAAQ,GAChBD,SAAS,CADXC,QAAQ;EAEV,IAAI,CAACA,QAAQ,EAAE;IACb,OAAOjB,KAAK;EACd;EACA,OAAOD,gBAAgB,CAACC,KAAK,EAAEC,SAAS,CAAC;AAC3C","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}