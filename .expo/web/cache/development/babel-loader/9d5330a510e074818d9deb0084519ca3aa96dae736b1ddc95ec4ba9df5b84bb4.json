{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"@babel/runtime/helpers/slicedToArray\");\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports.default = void 0;\nvar _invariant = _interopRequireDefault(require(\"../../common/invariant\"));\nvar SharedSubscribable = function () {\n  function SharedSubscribable(source) {\n    this._unsubscribeSource = null;\n    this._subscribers = [];\n    this._didEmit = false;\n    this._lastValue = null;\n    this._source = source;\n  }\n  var _proto = SharedSubscribable.prototype;\n  _proto.subscribe = function subscribe(subscriber, debugInfo) {\n    var _this = this;\n    var entry = [subscriber, debugInfo];\n    this._subscribers.push(entry);\n    if (this._didEmit) {\n      subscriber(this._lastValue);\n    }\n    if (1 === this._subscribers.length) {\n      this._unsubscribeSource = this._source(function (value) {\n        return _this._notify(value);\n      });\n    }\n    return function () {\n      return _this._unsubscribe(entry);\n    };\n  };\n  _proto._notify = function _notify(value) {\n    (0, _invariant.default)(this._subscribers.length, \"SharedSubscribable's source emitted a value after it was unsubscribed from\");\n    this._didEmit = true;\n    this._lastValue = value;\n    this._subscribers.forEach(function (_ref) {\n      var _ref2 = _slicedToArray(_ref, 1),\n        subscriber = _ref2[0];\n      subscriber(value);\n    });\n  };\n  _proto._unsubscribe = function _unsubscribe(entry) {\n    var idx = this._subscribers.indexOf(entry);\n    -1 !== idx && this._subscribers.splice(idx, 1);\n    if (!this._subscribers.length) {\n      var unsubscribe = this._unsubscribeSource;\n      this._unsubscribeSource = null;\n      this._didEmit = false;\n      unsubscribe && unsubscribe();\n    }\n  };\n  return SharedSubscribable;\n}();\nexports.default = SharedSubscribable;","map":{"version":3,"names":["_slicedToArray","require","_interopRequireDefault","exports","__esModule","default","_invariant","SharedSubscribable","source","_unsubscribeSource","_subscribers","_didEmit","_lastValue","_source","_proto","prototype","subscribe","subscriber","debugInfo","_this","entry","push","length","value","_notify","_unsubscribe","forEach","_ref","_ref2","idx","indexOf","splice","unsubscribe"],"sources":["/app/node_modules/@nozbe/watermelondb/utils/subscriptions/SharedSubscribable/index.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nexports.__esModule = true;\nexports.default = void 0;\nvar _invariant = _interopRequireDefault(require(\"../../common/invariant\"));\n// A subscribable that implements the equivalent of:\n// multicast(() => new ReplaySubject(1)) |> refCount Rx operation\n//\n// In other words:\n// - Upon subscription, the source subscribable is subscribed to,\n//   and its notifications are passed to subscribers here.\n// - Multiple subscribers only cause a single subscription of the source\n// - When last subscriber unsubscribes, the source is unsubscribed\n// - Upon subscription, the subscriber receives last value sent by source (if any)\nvar SharedSubscribable = /*#__PURE__*/function () {\n  function SharedSubscribable(source) {\n    this._unsubscribeSource = null;\n    this._subscribers = [];\n    this._didEmit = false;\n    this._lastValue = null;\n    this._source = source;\n  }\n  var _proto = SharedSubscribable.prototype;\n  _proto.subscribe = function subscribe(subscriber, debugInfo) {\n    var _this = this;\n    var entry = [subscriber, debugInfo];\n    this._subscribers.push(entry);\n    if (this._didEmit) {\n      subscriber(this._lastValue);\n    }\n    if (1 === this._subscribers.length) {\n      // TODO: What if this throws?\n      this._unsubscribeSource = this._source(function (value) {\n        return _this._notify(value);\n      });\n    }\n    return function () {\n      return _this._unsubscribe(entry);\n    };\n  };\n  _proto._notify = function _notify(value) {\n    (0, _invariant.default)(this._subscribers.length, \"SharedSubscribable's source emitted a value after it was unsubscribed from\");\n    this._didEmit = true;\n    this._lastValue = value;\n    this._subscribers.forEach(function ([subscriber]) {\n      subscriber(value);\n    });\n  };\n  _proto._unsubscribe = function _unsubscribe(entry) {\n    var idx = this._subscribers.indexOf(entry);\n    -1 !== idx && this._subscribers.splice(idx, 1);\n    if (!this._subscribers.length) {\n      var unsubscribe = this._unsubscribeSource;\n      this._unsubscribeSource = null;\n      this._didEmit = false;\n      unsubscribe && unsubscribe();\n    }\n  };\n  return SharedSubscribable;\n}();\nexports.default = SharedSubscribable;"],"mappings":"AAAA,YAAY;;AAAC,IAAAA,cAAA,GAAAC,OAAA;AAEb,IAAIC,sBAAsB,GAAGD,OAAO,CAAC,8CAA8C,CAAC;AACpFE,OAAO,CAACC,UAAU,GAAG,IAAI;AACzBD,OAAO,CAACE,OAAO,GAAG,KAAK,CAAC;AACxB,IAAIC,UAAU,GAAGJ,sBAAsB,CAACD,OAAO,yBAAyB,CAAC,CAAC;AAU1E,IAAIM,kBAAkB,GAAgB,YAAY;EAChD,SAASA,kBAAkBA,CAACC,MAAM,EAAE;IAClC,IAAI,CAACC,kBAAkB,GAAG,IAAI;IAC9B,IAAI,CAACC,YAAY,GAAG,EAAE;IACtB,IAAI,CAACC,QAAQ,GAAG,KAAK;IACrB,IAAI,CAACC,UAAU,GAAG,IAAI;IACtB,IAAI,CAACC,OAAO,GAAGL,MAAM;EACvB;EACA,IAAIM,MAAM,GAAGP,kBAAkB,CAACQ,SAAS;EACzCD,MAAM,CAACE,SAAS,GAAG,SAASA,SAASA,CAACC,UAAU,EAAEC,SAAS,EAAE;IAC3D,IAAIC,KAAK,GAAG,IAAI;IAChB,IAAIC,KAAK,GAAG,CAACH,UAAU,EAAEC,SAAS,CAAC;IACnC,IAAI,CAACR,YAAY,CAACW,IAAI,CAACD,KAAK,CAAC;IAC7B,IAAI,IAAI,CAACT,QAAQ,EAAE;MACjBM,UAAU,CAAC,IAAI,CAACL,UAAU,CAAC;IAC7B;IACA,IAAI,CAAC,KAAK,IAAI,CAACF,YAAY,CAACY,MAAM,EAAE;MAElC,IAAI,CAACb,kBAAkB,GAAG,IAAI,CAACI,OAAO,CAAC,UAAUU,KAAK,EAAE;QACtD,OAAOJ,KAAK,CAACK,OAAO,CAACD,KAAK,CAAC;MAC7B,CAAC,CAAC;IACJ;IACA,OAAO,YAAY;MACjB,OAAOJ,KAAK,CAACM,YAAY,CAACL,KAAK,CAAC;IAClC,CAAC;EACH,CAAC;EACDN,MAAM,CAACU,OAAO,GAAG,SAASA,OAAOA,CAACD,KAAK,EAAE;IACvC,CAAC,CAAC,EAAEjB,UAAU,CAACD,OAAO,EAAE,IAAI,CAACK,YAAY,CAACY,MAAM,EAAE,4EAA4E,CAAC;IAC/H,IAAI,CAACX,QAAQ,GAAG,IAAI;IACpB,IAAI,CAACC,UAAU,GAAGW,KAAK;IACvB,IAAI,CAACb,YAAY,CAACgB,OAAO,CAAC,UAAAC,IAAA,EAAwB;MAAA,IAAAC,KAAA,GAAA5B,cAAA,CAAA2B,IAAA;QAAbV,UAAU,GAAAW,KAAA;MAC7CX,UAAU,CAACM,KAAK,CAAC;IACnB,CAAC,CAAC;EACJ,CAAC;EACDT,MAAM,CAACW,YAAY,GAAG,SAASA,YAAYA,CAACL,KAAK,EAAE;IACjD,IAAIS,GAAG,GAAG,IAAI,CAACnB,YAAY,CAACoB,OAAO,CAACV,KAAK,CAAC;IAC1C,CAAC,CAAC,KAAKS,GAAG,IAAI,IAAI,CAACnB,YAAY,CAACqB,MAAM,CAACF,GAAG,EAAE,CAAC,CAAC;IAC9C,IAAI,CAAC,IAAI,CAACnB,YAAY,CAACY,MAAM,EAAE;MAC7B,IAAIU,WAAW,GAAG,IAAI,CAACvB,kBAAkB;MACzC,IAAI,CAACA,kBAAkB,GAAG,IAAI;MAC9B,IAAI,CAACE,QAAQ,GAAG,KAAK;MACrBqB,WAAW,IAAIA,WAAW,CAAC,CAAC;IAC9B;EACF,CAAC;EACD,OAAOzB,kBAAkB;AAC3B,CAAC,CAAC,CAAC;AACHJ,OAAO,CAACE,OAAO,GAAGE,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}