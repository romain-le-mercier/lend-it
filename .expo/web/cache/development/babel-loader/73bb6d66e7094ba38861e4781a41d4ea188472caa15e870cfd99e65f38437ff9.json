{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nexports.jsonDecorator = exports.default = void 0;\nvar _common = require(\"../common\");\nvar parseJSON = function parseJSON(value) {\n  if (null === value || value === undefined || '' === value) {\n    return undefined;\n  }\n  try {\n    return JSON.parse(value);\n  } catch (_) {\n    return undefined;\n  }\n};\nvar defaultOptions = {\n  memo: false\n};\nvar jsonDecorator = function jsonDecorator(rawFieldName, sanitizer) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultOptions;\n  return function (target, key, descriptor) {\n    (0, _common.ensureDecoratorUsedProperly)(rawFieldName, target, key, descriptor);\n    return {\n      configurable: true,\n      enumerable: true,\n      get: function get() {\n        var model = this;\n        var rawValue = model.asModel._getRaw(rawFieldName);\n        if (options.memo) {\n          model._jsonDecoratorCache = model._jsonDecoratorCache || {};\n          var cachedEntry = model._jsonDecoratorCache[rawFieldName];\n          if (cachedEntry && cachedEntry[0] === rawValue) {\n            return cachedEntry[1];\n          }\n        }\n        var parsedValue = parseJSON(rawValue);\n        var sanitized = sanitizer(parsedValue, model);\n        if (options.memo) {\n          model._jsonDecoratorCache[rawFieldName] = [rawValue, sanitized];\n        }\n        return sanitized;\n      },\n      set: function set(json) {\n        var model = this;\n        var sanitizedValue = sanitizer(json, model);\n        var stringifiedValue = null != sanitizedValue ? JSON.stringify(sanitizedValue) : null;\n        model.asModel._setRaw(rawFieldName, stringifiedValue);\n      }\n    };\n  };\n};\nexports.jsonDecorator = jsonDecorator;\nvar _default = jsonDecorator;\nexports.default = _default;","map":{"version":3,"names":["exports","__esModule","jsonDecorator","default","_common","require","parseJSON","value","undefined","JSON","parse","_","defaultOptions","memo","rawFieldName","sanitizer","options","arguments","length","target","key","descriptor","ensureDecoratorUsedProperly","configurable","enumerable","get","model","rawValue","asModel","_getRaw","_jsonDecoratorCache","cachedEntry","parsedValue","sanitized","set","json","sanitizedValue","stringifiedValue","stringify","_setRaw","_default"],"sources":["/app/node_modules/@nozbe/watermelondb/decorators/json/index.js"],"sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.jsonDecorator = exports.default = void 0;\nvar _common = require(\"../common\");\n// Defines a model property that's (de)serialized to and from JSON using custom sanitizer function.\n//\n// Pass the database column name as first argument, and sanitizer function as second.\n//\n// Stored value will be parsed to JSON if possible, and passed to sanitizer as argument, or\n// undefined will be passed on parsing error. Field value will be result of sanitizer call.\n//\n// Value assigned to field will be passed to sanitizer and its results will be stored as stringified\n// value.\n//\n// Examples:\n//   @json('contact_info', jsonValue => jasonValue || {}) contactInfo: ContactInfo\nvar parseJSON = function (value) {\n  // fast path\n  if (null === value || value === undefined || '' === value) {\n    return undefined;\n  }\n  try {\n    return JSON.parse(value);\n  } catch (_) {\n    return undefined;\n  }\n};\nvar defaultOptions = {\n  memo: false\n};\nvar jsonDecorator = function (rawFieldName, sanitizer, options = defaultOptions) {\n  return function (target, key, descriptor) {\n    (0, _common.ensureDecoratorUsedProperly)(rawFieldName, target, key, descriptor);\n    return {\n      configurable: true,\n      enumerable: true,\n      get: function get() {\n        // $FlowFixMe\n        var model = this;\n        var rawValue = model.asModel._getRaw(rawFieldName);\n        if (options.memo) {\n          // Use cached value if possible\n          model._jsonDecoratorCache = model._jsonDecoratorCache || {};\n          var cachedEntry = model._jsonDecoratorCache[rawFieldName];\n          if (cachedEntry && cachedEntry[0] === rawValue) {\n            return cachedEntry[1];\n          }\n        }\n        var parsedValue = parseJSON(rawValue);\n        var sanitized = sanitizer(parsedValue, model);\n        if (options.memo) {\n          model._jsonDecoratorCache[rawFieldName] = [rawValue, sanitized];\n        }\n        return sanitized;\n      },\n      set: function set(json) {\n        // $FlowFixMe\n        var model = this;\n        var sanitizedValue = sanitizer(json, model);\n        var stringifiedValue = null != sanitizedValue ? JSON.stringify(sanitizedValue) : null;\n        model.asModel._setRaw(rawFieldName, stringifiedValue);\n      }\n    };\n  };\n};\nexports.jsonDecorator = jsonDecorator;\nvar _default = jsonDecorator;\nexports.default = _default;"],"mappings":"AAAA,YAAY;;AAEZA,OAAO,CAACC,UAAU,GAAG,IAAI;AACzBD,OAAO,CAACE,aAAa,GAAGF,OAAO,CAACG,OAAO,GAAG,KAAK,CAAC;AAChD,IAAIC,OAAO,GAAGC,OAAO,YAAY,CAAC;AAalC,IAAIC,SAAS,GAAG,SAAZA,SAASA,CAAaC,KAAK,EAAE;EAE/B,IAAI,IAAI,KAAKA,KAAK,IAAIA,KAAK,KAAKC,SAAS,IAAI,EAAE,KAAKD,KAAK,EAAE;IACzD,OAAOC,SAAS;EAClB;EACA,IAAI;IACF,OAAOC,IAAI,CAACC,KAAK,CAACH,KAAK,CAAC;EAC1B,CAAC,CAAC,OAAOI,CAAC,EAAE;IACV,OAAOH,SAAS;EAClB;AACF,CAAC;AACD,IAAII,cAAc,GAAG;EACnBC,IAAI,EAAE;AACR,CAAC;AACD,IAAIX,aAAa,GAAG,SAAhBA,aAAaA,CAAaY,YAAY,EAAEC,SAAS,EAA4B;EAAA,IAA1BC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAT,SAAA,GAAAS,SAAA,MAAGL,cAAc;EAC7E,OAAO,UAAUO,MAAM,EAAEC,GAAG,EAAEC,UAAU,EAAE;IACxC,CAAC,CAAC,EAAEjB,OAAO,CAACkB,2BAA2B,EAAER,YAAY,EAAEK,MAAM,EAAEC,GAAG,EAAEC,UAAU,CAAC;IAC/E,OAAO;MACLE,YAAY,EAAE,IAAI;MAClBC,UAAU,EAAE,IAAI;MAChBC,GAAG,EAAE,SAASA,GAAGA,CAAA,EAAG;QAElB,IAAIC,KAAK,GAAG,IAAI;QAChB,IAAIC,QAAQ,GAAGD,KAAK,CAACE,OAAO,CAACC,OAAO,CAACf,YAAY,CAAC;QAClD,IAAIE,OAAO,CAACH,IAAI,EAAE;UAEhBa,KAAK,CAACI,mBAAmB,GAAGJ,KAAK,CAACI,mBAAmB,IAAI,CAAC,CAAC;UAC3D,IAAIC,WAAW,GAAGL,KAAK,CAACI,mBAAmB,CAAChB,YAAY,CAAC;UACzD,IAAIiB,WAAW,IAAIA,WAAW,CAAC,CAAC,CAAC,KAAKJ,QAAQ,EAAE;YAC9C,OAAOI,WAAW,CAAC,CAAC,CAAC;UACvB;QACF;QACA,IAAIC,WAAW,GAAG1B,SAAS,CAACqB,QAAQ,CAAC;QACrC,IAAIM,SAAS,GAAGlB,SAAS,CAACiB,WAAW,EAAEN,KAAK,CAAC;QAC7C,IAAIV,OAAO,CAACH,IAAI,EAAE;UAChBa,KAAK,CAACI,mBAAmB,CAAChB,YAAY,CAAC,GAAG,CAACa,QAAQ,EAAEM,SAAS,CAAC;QACjE;QACA,OAAOA,SAAS;MAClB,CAAC;MACDC,GAAG,EAAE,SAASA,GAAGA,CAACC,IAAI,EAAE;QAEtB,IAAIT,KAAK,GAAG,IAAI;QAChB,IAAIU,cAAc,GAAGrB,SAAS,CAACoB,IAAI,EAAET,KAAK,CAAC;QAC3C,IAAIW,gBAAgB,GAAG,IAAI,IAAID,cAAc,GAAG3B,IAAI,CAAC6B,SAAS,CAACF,cAAc,CAAC,GAAG,IAAI;QACrFV,KAAK,CAACE,OAAO,CAACW,OAAO,CAACzB,YAAY,EAAEuB,gBAAgB,CAAC;MACvD;IACF,CAAC;EACH,CAAC;AACH,CAAC;AACDrC,OAAO,CAACE,aAAa,GAAGA,aAAa;AACrC,IAAIsC,QAAQ,GAAGtC,aAAa;AAC5BF,OAAO,CAACG,OAAO,GAAGqC,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}